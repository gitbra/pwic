{% extends 'main.html' %}


{% block content %}
	<header>
		<div class="pwic_ph1"><a href="/{% if pwic.page != 'home' %}{{pwic.project|urlencode}}{% endif %}">{{pwic.project_description|escape}}</a></div>
		{% if (not pwic.env.no_search) or (pwic.links|count > 0) %}
			<div class="pwic_tagbox">
				{% for link in pwic.links %}
					<a href="/{{pwic.project|urlencode}}/{{link.page|urlencode}}">{{link.title|escape}}</a>
				{% endfor %}
				{% if not pwic.env.no_search %}
					<div class="pwic_searchbox">
						{{pwic.emojis.search}}
						<input type="text" id="page_search" onkeypress="page_search()" />
					</div>
				{% endif %}
			</div>
		{% endif %}
	</header>

	{% if pwic.env.no_text_selection %}
		{% include 'page-special-nosel.js.html' %}
	{% endif %}
	{% include 'page.js.html' %}
	{% if not pwic.env.no_search %}
		{% include 'search.js.html' %}
	{% endif %}

	<article>
		<div id="pwic_progress"></div>

		{% if pwic.env.maintenance %}
			<div class="pwic_error">{{pwic.emojis.calendar}} {{pwic.env.maintenance.value|escape|replace('\\n','<br/>')}}</div>
		{% endif %}
		{% if pwic.env.message %}
			<div class="pwic_information">{{pwic.emojis.pin}} {{pwic.env.message.value|escape|replace('\\n','<br/>')}}</div>
		{% endif %}

		<div class="pwic_action_bar">
			{% if pwic.protection %}
				<span title="The page is protected">{{pwic.emojis.padlock}}</span>
			{% endif %}
			<a href="/{{pwic.project|urlencode}}/special">{{pwic.emojis.star}} Special</a>
			{% if pwic.manager %}
				<a href="/special/page/create?project={{pwic.project|urlencode}}">{{pwic.emojis.sheet}} New page</a>
			{% endif %}
			{% if pwic.latest and (pwic.manager or (pwic.editor and not pwic.protection)) %}
				<a href="/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/edit">{{pwic.emojis.set_square}} Edit</a>
			{% endif %}
			{% if not pwic.pure_reader or not pwic.env.no_history %}
				<a href="/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/history">{{pwic.emojis.scroll}} History</a>
			{% endif %}
			{% if pwic.manager %}
				<a href="/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/move">{{pwic.emojis.truck}} Move</a>
			{% endif %}

			<a href="#" onclick="page_email('Warning: the current page is a draft, so its content may disappear in the future without notice.')">{{pwic.emojis.outbox}} Email</a>
			{% if not pwic.env.no_printing %}
				<a href="#" onclick="page_print()">{{pwic.emojis.printer}} Print</a>
			{% endif %}

			{% set formats = pwic.env.get('file_formats', {'value': ''}).value.split(' ') %}
			{% set no_formats = pwic.env.get('file_formats_disabled', {'value': ''}).value.split(' ') %}
			{% if '*' not in no_formats %}
				{% for f in formats%}
					{% if f not in no_formats %}
						<a href="#" title="Export to {{f|escape|upper}}" onclick="return page_export('{{f|escape}}')">{{pwic.emojis.memo}} {{f|escape|upper}}</a>
					{% endif %}
				{% endfor %}
			{% endif %}

			{% if pwic.validator and (pwic.valuser == '') and pwic.final %}
				<a href="#" onclick="return page_post_action('validate', 'The validation cannot be undone.\n\nDo you want to continue ?')">{{pwic.emojis.validate}} Validate</a>
			{% endif %}
			{% if pwic.removable %}
				<a href="#" onclick="return page_post_action('delete', 'WARNING: deleting the revision cannot be undone.\n\nDo you want to continue ?')">{{pwic.emojis.recycle}} Delete</a>
			{% endif %}
		</div>

		{% if not pwic.latest %}
			<p class="pwic_warning">{{pwic.emojis.eye}} You are viewing the <span class="pwic_bold">revision {{pwic.revision}}</span>
				{% if pwic.env.validated_only %}
					and <a href="/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/history">non-validated revisions</a> are pending.
				{% else %}
					, unless you prefer the <a href="/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}">latest version</a>.
				{% endif %}
			</p>
		{% endif %}

		{% if pwic.valuser != '' %}
			<p class="pwic_information">{{pwic.emojis.flag}} This page has been validated by <a href="/special/user/{{pwic.valuser|urlencode}}" rel="nofollow">{{pwic.valuser|escape}}</a> on {{pwic.valdate|urlencode}} at {{pwic.valtime|escape}}.</p>
		{% endif %}

		{% if pwic.tmap|count > 0 %}
			<div id="pwic_browser_access" title="Show/Hide the map of the article" onclick="page_tmap()">
				{{pwic.emojis.pin}}
			</div>
			<div id="pwic_browser" class="pwic_hidden">
				{% for tmap in pwic.tmap %}
					<a class="pwic_browser_item pwic_browser_item_h{{tmap.level}}" href="#{{tmap.tag|urlencode}}" onclick="page_tmap()"><span class="pwic_bold">{{tmap.header|escape}}</span> {{tmap.title|escape}}</a>
				{% endfor %}

				{% if (pwic.documents|count > 0) or (pwic.images|count > 0) %}
					<a class="pwic_browser_item pwic_browser_item_h1" href="#page_documents" onclick="page_tmap()">{{pwic.emojis.scroll}} Attached documents</a>
				{% endif %}
			</div>
		{% endif %}

		{% if pwic.relations|count > 0 %}
			<p id="pwic_relations">
				<span class="pwic_bold">Related pages:</span>
				{% for p in pwic.relations %}
					{% if loop.index > 1 %} &ndash; {% endif %}
					<a href="{{p[0]|escape}}">{{p[1]|escape}}</a>
				{% endfor %}
			</p>
		{% endif %}

		{% if pwic.tags|count > 0 %}
			<div class="pwic_tagbox">
				{% for tag in pwic.tags %}
					{% if pwic.env.no_search %}
						<a href="#" onclick="return false">#{{tag|escape}}</a>
					{% else %}
						<a href="/{{pwic.project|urlencode}}/special/search?q=%23{{tag|urlencode}}" title="Search for related classified pages">#{{tag|escape}}</a>
					{% endif %}
				{% endfor %}
			</div>
		{% endif %}

		{{pwic.html}}

		{% if (pwic.images|count > 0) or (pwic.documents|count > 0) %}
			<h1 id="page_documents" class="pwic_cursor" title="Expand/Collapse" onclick="$('#page_section_files').toggleClass('pwic_hidden')">Attached documents</h1>

			<div id="page_section_files">
				{% if pwic.documents|count > 0 %}
					<div class="pwic_file_gallery">
						<a href="/special/documents/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/download" rel="nofollow">
							<span>Download all</span>
							<br/>{{pwic.emojis.inbox}}
						</a>
						{% for doc in pwic.documents %}
							<a href="/special/document/{{doc.id|urlencode}}/{{doc.filename|urlencode}}" title="Uploaded by {{doc.author|escape}} on {{doc.date|escape}} at {{doc.time|escape}}">
								<span>{{doc.filename|escape}}</span>
								<br/><small>{{doc.mime|escape}}</small> ({{doc.size|escape}})
							</a>
						{% endfor %}
					</div>
				{% endif %}

				{% if pwic.images|count > 0 %}
					<div class="pwic_file_gallery">
						{% if pwic.documents|count == 0 %}
							<a href="/special/documents/{{pwic.project|urlencode}}/{{pwic.page|urlencode}}/download" rel="nofollow">
								<span>Download all</span>
								<br/>{{pwic.emojis.inbox}}
							</a>
						{% endif %}
						{% for doc in pwic.images %}
							<a href="/special/document/{{doc.id|urlencode}}/{{doc.filename|urlencode}}" title="Uploaded by {{doc.author|escape}} on {{doc.date|escape}} at {{doc.time|escape}}">
								<span>{{doc.filename|escape}}</span>
								<br/><small>{{doc.mime|escape}}</small> ({{doc.size|escape}})
							</a>
						{% endfor %}
					</div>
				{% endif %}
			</div>
		{% endif %}

		<p id="page_lastmod">
			Revision <span class="pwic_bold">#{{pwic.revision|escape}}</span> was last modified by <a href="/special/user/{{pwic.author|urlencode}}" rel="nofollow">{{pwic.author|escape}}</a>
			<br/>on {{pwic.date}} at {{pwic.time}} &mdash; <span title="Hash: {{pwic.hash|escape}}">{{pwic.hash[:16]}}</span>
		</p>

		{% if pwic.env.legal_notice %}
			<div id="page_legal_notice">{{pwic.env.legal_notice.value|escape|replace('\n','<br/>')}}</div>
		{% endif %}
	</article>
{% endblock %}


{% block footer %}
	{% include "en/footer.html" %}
{% endblock %}
