<script>
	'use strict';

	function user_password_popup() {
		$('#user_password_popup').toggleClass('pwic_hidden');
		if ($('#user_password_popup').hasClass('pwic_hidden'))
			$('#user_password_current, #user_password_new1, #user_password_new2').val('');
		else
			document.getElementById('user_password_current').focus();
		return false;
	}

	function user_password_submit(errorParamText, successText, errorText) {
		var	cur  = $('#user_password_current').val(),
			new1 = $('#user_password_new1').val(),
			new2 = $('#user_password_new2').val();
		if (([cur, new1, new2].indexOf('') !== -1) || (new1 != new2) || (new1 == cur))
			alert(errorParamText);
		else {
			fetch('/api/user/password/change', {	method: 'POST',
													headers: {'Content-Type': 'application/x-www-form-urlencoded'},
													body:	'password_current='+encodeURIComponent(cur) +
															'&password_new1='+encodeURIComponent(new1) +
															'&password_new2='+encodeURIComponent(new2),
													credentials: 'same-origin' })
				.then(function(response) {
					if (!response.ok) {
						document.getElementById('user_password_new1').focus();
						throw Error(errorText + ' ['+response.status+']');
					} else {
						user_password_popup();
						$('#pwic_password_status').html('{{pwic.emojis.green_check}}');
						alert(successText);
					}
				})
				.catch(function(error) {
					alert(error);
				});
		}
	}
</script>